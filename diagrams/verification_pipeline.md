# StyleGAN Watermarking Verification Pipeline

```mermaid
flowchart TB
    %% Styling
    classDef verification fill:#e8f5e9,stroke:#2e7d32,stroke-width:2px
    classDef extraction fill:#fff8e1,stroke:#f57f17,stroke-width:2px
    classDef vector fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px
    classDef input fill:#fff3e0,stroke:#e65100,stroke-width:3px,color:#000000,font-weight:bold
    classDef decision fill:#e1f5fe,stroke:#0277bd,stroke-width:2px
    classDef title fill:none,stroke:none,font-size:18px,font-weight:bold,color:#333333
    classDef result fill:#fbe9e7,stroke:#d84315,stroke-width:2px,font-weight:bold
    classDef inputBox fill:#ffebcc,stroke:#ff9800,stroke-width:3px,stroke-dasharray: 5 5
    classDef subgraphBorder fill:white,stroke:#666666,stroke-width:1px,stroke-dasharray: 5 5
    classDef keyBox fill:white,stroke:#673ab7,stroke-width:2px,color:#673ab7,font-weight:bold

    %% Inputs Section - More visually distinctive 
    subgraph inputSection[" INPUTS "]
        direction TB
        image[" Image to Verify "]
        w_partial[" w_partial Vector<br>Provided by Model Generator "]
    end
    
    style inputSection fill:#fff9c4,stroke:#ffc107,stroke-width:3px,color:#ff6f00,font-weight:bold,font-size:16px

    %% Key Generation
    subgraph key_generation[" KEY GENERATION "]
        direction TB
        keymapper[" Key Mapper<br>［w_partial ➜ binary key］"]
        tkey[" True Key<br>［Binary］"]:::keyBox
    end
    
    style key_generation fill:#e3f2fd,stroke:#2196f3,stroke-width:2px,color:#0d47a1,font-weight:bold,font-size:16px

    %% Key Extraction
    subgraph key_extraction[" KEY EXTRACTION "]
        direction TB
        decoder[" Decoder Network<br>［Trained During Watermarking］"]
        ekey[" Extracted Key<br>［Binary］"]:::keyBox
    end
    
    style key_extraction fill:#e0f2f1,stroke:#009688,stroke-width:2px,color:#004d40,font-weight:bold,font-size:16px

    %% Verification
    subgraph verification[" VERIFICATION "]
        direction TB
        compare[" Compare Keys<br>［Bit-by-Bit Comparison］"]
        decision{" Do All<br>Bits Match? "}
        authentic[" ✓ AUTHENTIC<br>Image Generated by<br>Watermarked Model "]
        fake[" ✗ SUSPICIOUS<br>Image Not Generated by<br>Watermarked Model<br>or Was Modified "]
    end
    
    style verification fill:#f3e5f5,stroke:#9c27b0,stroke-width:2px,color:#4a148c,font-weight:bold,font-size:16px

    %% Connections with improved visibility
    w_partial --> keymapper
    keymapper --> tkey
    image --> decoder
    decoder --> ekey
    
    tkey --> compare
    ekey --> compare
    
    compare --> decision
    decision -->|" Yes "| authentic
    decision -->|" No "| fake
    
    %% Styling
    image:::input
    w_partial:::input
    keymapper:::extraction
    decoder:::verification
    compare:::verification
    decision:::decision
    authentic:::result
    fake:::result

    %% Add a note explaining the process
    classDef note fill:#fffde7,stroke:#ffd600,stroke-width:1px,color:#bf360c,font-style:italic
    note[" Note: The Key Mapper and Decoder Network<br>are the same components used during<br>the original watermarking process. "]:::note
    note -.-> key_generation
    note -.-> key_extraction
```

## Description

This diagram illustrates the verification pipeline for authenticating images generated by a watermarked StyleGAN2 model:

1. **Inputs**
   - The image to be verified (potentially generated by a watermarked model)
   - The w_partial vector provided by the model generator alongside the image

2. **Key Generation**
   - The Key Mapper generates the true binary key from w_partial
   - This is the same Key Mapper used during the watermarking process

3. **Key Extraction**
   - The trained Decoder Network extracts a binary key from the image
   - This Decoder was trained during the watermarking process

4. **Verification**
   - The two keys are compared bit by bit
   - If all bits match, the image is deemed authentic (generated by the watermarked model)
   - If any bits don't match, the image is flagged as suspicious (potentially modified or generated by a different model)

## Use Cases

1. **Content Authenticity Verification**
   - Verify that an image was generated by a specific watermarked model
   - Detect images that have been tampered with or generated by unauthorized models

2. **Copyright Protection**
   - Provide evidence that an image was generated by a specific model
   - Help in tracking the provenance of AI-generated content

3. **Model Attribution**
   - Enable model creators to prove ownership of generated content
   - Allow users to verify the source of AI-generated images 